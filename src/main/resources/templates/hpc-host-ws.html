<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>

    <title>HPC Hosts WS</title>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">

</head>
<body>

<header>Future Site Branding and Logo</header>

<a th:href="@{/}" >Return to Home</a>

<main>
    <h1 th:text="${pageTitle}"></h1>

    <!-- Display the JSON String -->
    <div id="server-status" th:text="${serverStatus}"></div>

</main>

<footer>
    <p>Copyright 2025 UCAR</p>
</footer>

<script src="/webjars/sockjs-client/1.5.1/sockjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@stomp/stompjs@7.0.0/bundles/stomp.umd.min.js"></script>

<script>
    let stompClient = null;

    function connect() {
        const socket = new SockJS('/websocket');
        stompClient = StompJs.Stomp.over(socket);

        stompClient.connect({}, function () {
            console.log('Connected!');

            // Subscribe to server status updates
            stompClient.subscribe('/topic/status', function (message) {
                const serverStatus = JSON.parse(message.body);

                updateStatus(serverStatus);
            });
        });
    }

    function updateStatus(status) {

        console.log('Update status.');

        document.addEventListener("DOMContentLoaded", function ()  {

            const serverStatus = document.getElementById("server-status");

            serverStatus.innerHTML = JSON.stringify(status, null, 2);
        });

    }

    connect();
</script>
</body>
</html>
