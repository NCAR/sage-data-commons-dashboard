<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/headContent.html}">
    <title th:text="${pageTitle ?: 'Default Title'}">Job Details</title>
</head>
<body>

<header>Future Site Branding and Logo</header>

<a th:href="@{/}" >Return to Home</a>

<main>
    <h1 th:text="${pageTitle}"></h1>

    <p><strong>Report Time:</strong> <span th:text="${formattedTimestamp}"></span></p>
    <p><strong>Timestamp:</strong> <span th:text="${timestamp}"></span></p>
    <p><strong>Pbs Version:</strong> <span th:text="${pbsVersion}"></span></p>
    <p><strong>Pbs Server:</strong> <span th:text="${pbsServer}"></span></p>

    <table id="jobTable" class="table table-bordered table-striped">
        <thead class="table-header">
        <tr>
            <th>Job Key</th>
            <th>Job Name</th>
            <th>Job Owner</th>
            <th>Job State</th>
            <th>Queue</th>
            <th>Server</th>
            <th>Account Name</th>
            <th>Checkpoint</th>

            <th>Creation Time String yyyy-MM-dd HH:mm:ss</th>
            <th>Creation Time epoch</th>

            <th>Hold Types</th>
            <th>Join Path</th>
            <th>Keep Files</th>
            <th>Mail Points</th>
            <th>Modification Time String yyyy-dd-MM HH:mm:ss</th>
            <th>Modification Time Epoch</th>

            <th>Priority</th>
            <th>Queue Time String EEE MMM dd HH:mm:ss yyyy</th>
            <th>Queue Time Epoch</th>

            <th>Rerunable</th>

            <th>Start Time String MMM dd HH:mm:ss yyyy</th>
            <th>Start Time Epoch</th>

            <th>Obit Time String dd-MM-yyyy HH:mm:ss</th>
            <th>Obit Time Epoch</th>

            <th>Shell Path List</th>
            <th>Job Directory</th>
            <th>Substate</th>
            <th>Comment</th>

            <th>Elapsed Time String yyyy/MM/dd HH:mm:ss</th>
            <th>Elapsed Time Epoch</th>

            <th>Umask</th>
            <th>Run Count</th>
            <th>Eligible Time</th>
            <th>Exit Status</th>
            <th>Submit Arguments</th>
            <th>Project</th>
            <th>Submit Host</th>
            <th>Server Instance ID</th>
            <!--Resource Columns -->
            <th>mem</th>
            <th>mpiprocs</th>
            <th>mps</th>
            <th>ncpus</th>
            <th>ngpus</th>
            <th>nodect</th>
            <th>place</th>
            <th>select</th>
            <th>walltime</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="job : ${jobs}">
            <td><span th:text="${job.jobId}"></span></td>
            <td><span th:text="${job.jobName}"></span></td>
            <td><span th:text="${job.jobOwner}"></span></td>
            <td><span th:text="${job.jobState}"></span></td>
            <td><span th:text="${job.queue}"></span></td>
            <td><span th:text="${job.server}"></span></td>
            <td><span th:text="${job.accountName}"></span></td>
            <td><span th:text="${job.checkpoint}"></span></td>

            <td><span th:text="${#dates.format(job.ctime, 'yyyy-MM-dd HH:mm:ss')}" ></span></td>
            <td><span th:text="${job.ctime}"></span> <span class="timezone-column" th:if="${job.ctime != null}"></span></td>

            <td><span th:text="${job.holdTypes}"></span></td>
            <td><span th:text="${job.joinPath}"></span></td>
            <td><span th:text="${job.keepFiles}"></span></td>
            <td><span th:text="${job.mailPoints}"></span></td>

            <td><span th:text="${#dates.format(job.mtime, 'yyyy-dd-MM HH:mm:ss')}" ></span></td>
            <td><span th:text="${job.mtime}"></span> <span class="timezone-column" th:if="${job.mtime != null}"></span></td>

            <td><span th:text="${job.priority}"></span></td>

            <td><span th:text="${#dates.format(job.qtime, 'EEE MMM dd HH:mm:ss yyyy')}" ></span></td>
            <td><span th:text="${job.qtime}"></span> <span class="timezone-column" th:if="${job.qtime != null}"></span></td>

            <td><span th:text="${job.rerunable}"></span></td>

            <td><span th:text="${#dates.format(job.stime, 'MMM dd HH:mm:ss yyyy')}" ></span></td>
            <td><span th:text="${job.stime}"></span> <span class="timezone-column" th:if="${job.stime != null}"></span></td>

            <td><span th:text="${#dates.format(job.obittime, 'dd-MM-yyyy HH:mm:ss')}" ></span></td>
            <td><span th:text="${job.obittime}"></span> <span class="timezone-column" th:if="${job.obittime != null}"></span></td>

            <td><span th:text="${job.shellPathList}"></span></td>
            <td><span th:text="${job.jobdir}"></span></td>
            <td><span th:text="${job.substate}"></span></td>
            <td><span th:text="${job.comment}"></span></td>

            <td><span th:text="${#dates.format(job.etime, 'yyyy/MM/dd HH:mm:ss')}" ></span></td>
            <td><span th:text="${job.etime}"></span> <span class="timezone-column" th:if="${job.etime != null}"></span></td>

            <td><span th:text="${job.umask}"></span></td>
            <td><span th:text="${job.runCount}"></span></td>
            <td><span th:text="${job.eligibleTime}"></span></td>
            <td><span th:text="${job.exitStatus}"></span></td>
            <td><span th:text="${job.submitArguments}"></span></td>
            <td><span th:text="${job.project}"></span></td>
            <td><span th:text="${job.submitHost}"></span></td>
            <td><span th:text="${job.serverInstanceId}"></span></td>

            <td th:text="${job.mem}"></td>
            <td th:text="${job.mpiprocs}"></td>
            <td th:text="${job.mps}"></td>
            <td th:text="${job.ncpus}"></td>
            <td th:text="${job.ngpus}"></td>
            <td th:text="${job.nodect}"></td>

            <td th:text="${job.place}"></td>
            <td th:text="${job.select}"></td>
            <td th:text="${job.walltime}"></td>
        </tr>
        </tbody>
    </table>

</main>

<footer>
    <p>Copyright 2025 UCAR</p>
</footer>

<script th:src="@{/js/dateTimeUtils.js}"></script>

<script>

    $(document).ready(function () {

        // Put # rows displayed/total at top of table also.
        $('#jobTable').DataTable({
            paging: false,
            deferRender: true, // Enable deferred rendering
            dom: '<"top"if>rt<"bottom"i><"clear">', // f for search/filter box
            language: {
                info: "Showing _START_ to _END_ of _TOTAL_ entries",
                infoFiltered: "(filtered from _MAX_ total entries)"
            }
        });

        // Function to update all targeted columns with the time zone abbreviation
        function updateTableWithTimeZone() {

            const timeZoneAbbr = getCurrentTimeZoneAbbreviation(); // Fetch timezone abbreviation
            const elements = document.querySelectorAll('.timezone-column'); // Select all target columns

            elements.forEach(column => {
                column.innerText = timeZoneAbbr; // Update each column
            });
        }

        // Call the function to update all relevant table columns
        updateTableWithTimeZone();
    });

</script>

</body>
</html>